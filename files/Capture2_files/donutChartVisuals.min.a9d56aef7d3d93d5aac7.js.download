"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['donutChartVisuals.min.js'] || (this.parseTimeMarkers['donutChartVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('donutChartVisuals.min.js');var es6,powerbi,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||((i=i||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},__extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}();!function(e){var c;function l(e,t,a){var i=Math.sqrt(a.x*a.x+a.y*a.y);return!(i<t.innerRadius||i>t.outerRadius||(i=r(a))<e.startAngle||i>e.endAngle)}function r(e){var t;if(e)return t=e.x,e=-e.y,(t=Math.atan2(t,e))<0&&(t+=2*Math.PI),t}c=e.visuals||(e.visuals={}),(e=c.DonutLabelUtils||(c.DonutLabelUtils={})).DiagonalLineIndex=0,e.HorizontalLineIndex=1,e.getLabelLeaderLineForDonutChart=function(e,t,a,i,r,n,s){void 0===r&&(r=0),void 0===n&&(n=0);var o,l=.8/.9*1.025,d=(i=(i=void 0===i?0:i)?(i=i,d=t.labelRadius,o=[Math.cos(i)*d,Math.sin(i)*d],[Math.cos(i)*d,Math.sin(i)*d]):(o=t.labelArc.centroid(e),t.labelArc.centroid(e)),null!=s&&s.pieChartMarginBetweenSlices&&(o[0]=o[0]-r,o[1]=o[1]-n,i[0]=i[0]-r,i[1]=i[1]-n),a.x),t=c.DataLabelViewModel.maxLabelOffset/2,e=[d+=d<0?-t:t,a.y];return i[0]*=l,i[1]*=l,[i,o,e]},e.getLabelLeaderLinesSizeForDonutChart=function(e){return e&&2<e.length?[{width:Math.abs(e[1][0]-e[0][0]),height:Math.abs(e[1][1]-e[0][1])},{width:Math.abs(e[2][0]-e[1][0]),height:c.DataLabelRenderer.LineStrokeWidth}]:null},e.getXPositionForDonutLabel=function(e){return e+(e<0?-c.DataLabelViewModel.maxLabelOffset:c.DataLabelViewModel.maxLabelOffset)},e.getSpaceAvailableForDonutLabels=function(e,t){return t.width/2-Math.abs(e)-c.DataLabelViewModel.maxLabelOffset},e.getLabelPosition=function(e,t){var a=t*Math.sin(e-Math.PI/2);return{x:t*Math.cos(e-Math.PI/2),y:a}},e.canLabelFit=function(e,t,a){for(var i=a.left,r=a.left+a.width,n=a.top,a=a.top+a.height,s=0,o=[{x:i,y:n},{x:i,y:a},{x:r,y:n},{x:r,y:a}];s<o.length;s++)if(!l(e,t,o[s]))return!1;return!0},e.canPointFit=l,e.getAngleFromPoint=r}(powerbi=powerbi||{}),function(g){var s,R=g.visuals||(g.visuals={}),n=g.visuals.builder,e=jsCommon.CssConstants.createClassAndSelector,D=jsCommon.EnumExtensions,t=R.labelStyle,w=R.labelStyle.labelStyleFlagEnum,u=g.data.Selector,M=((a=s=s||{}).animationDurationMs=500,a.ease="cubic-in-out",R.donutChartProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:"legend",propertyName:"show"},position:{objectName:"legend",propertyName:"position"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"}},slices:{innerRadiusRatio:{objectName:"slices",propertyName:"innerRadiusRatio"},startAngle:{objectName:"slices",propertyName:"startAngle"},borderWidth:{objectName:"slices",propertyName:"borderWidth"},borderColor:{objectName:"slices",propertyName:"borderColor"},explode:{objectName:"slices",propertyName:"explode"}},labels:{position:{objectName:"labels",propertyName:"position"},overflow:{objectName:"labels",propertyName:"overflow"},background:{objectName:"labels",propertyName:"background"}}},R.SubSelectionSlicesClassAndSelector=e("sub-selection-slices"),R.SubSelectionSliceClassAndSelector=e("sub-selection-slice"),x.UpdateCurrentArcElementFunc=function(e){this._current=e},x.getDefaultDonutLabelSettings=function(e){return __assign(__assign({},x.getDefaultLabelSettings(e)),{labelStyle:t.category,percentagePrecision:R.DataLabelViewModel.defaultPercentageLabelPrecision,position:R.donutLabelPosition.outside,overflow:!0,enableBackgroundWithAuto:R.donutLabelBackground.auto,bold:!1,italic:!1,underline:!1})},x.converter=function(e,t,a,i,r,n,s,o,l){var d,c,a=new p.DonutChartConverter(e,t,a,o=void 0===o?!0:o),o=(a.convert(),a.startAngle*(Math.PI/x.OnePiRadianInDegree)),h=o+2*Math.PI,u=d3.pie().startAngle(o).endAngle(h).sort(null).value(function(e){return e.percentage}),s=(s&&(d=!a.hasCategoryData&&a.hasSeriesData?R.DataPointNavigationStrategy.SeriesOnly:a.hasCategoryData&&a.hasSeriesData?R.DataPointNavigationStrategy.CategoryFirst:R.DataPointNavigationStrategy.CategoryOnly,s.applySelectionStateToData(a.dataPoints),s.applySelectionStateToData(a.legendData.dataPoints)),!n&&r?x.cullDataByViewport(a.dataPoints,a.maxValue,r,t.isHighContrast,a.borderWidth,l):a.dataPoints);return l&&l.onObject&&i&&(c=this.getSubSelectionArcDescriptors({dataView:e,dataPoints:s,hasCategoryData:a.hasCategoryData,hasDynamicSeries:a.hasDynamicSeries,startAngle:o,endAngle:h})),{dataPointsToDeprecate:s,dataPoints:u(s),unCulledDataPoints:a.dataPoints,dataPointsToEnumerate:a.legendData.dataPoints,legendData:a.legendData,hasHighlights:a.hasHighlights,highlightsOverflow:a.highlightsOverflow,dataLabelsSettings:a.dataLabelsSettings,legendObjectProperties:a.legendObjectProperties,maxValue:a.maxValue,visibleGeometryCulled:a.dataPoints.length!==s.length,hasNegativeValues:a.hasNegativeValues,allValuesAreNegative:a.allValuesAreNegative,donutInnerRadiusRatio:a.donutInnerRadiusRatio,startAngle:a.startAngle,navigationStrategy:d,explode:a.explode,borderWidth:a.borderWidth,borderColor:a.borderColor,hasDynamicSeries:a.hasDynamicSeries,hasSeriesData:a.hasSeriesData,hasCategoryData:a.hasCategoryData,subSelectionDataPoints:c}},x.getSubSelectionArcDescriptors=function(e){for(var t=e.dataPoints,a=e.endAngle,i=e.hasCategoryData,r=e.hasDynamicSeries,e=e.startAngle,n={},s=0,o=t;s<o.length;s++){var l=o[s],d=l.categoryIndex,c=l.seriesIndex,h=l.percentage,u=i||!r,g=u?d:c,p=n[g];p||(p={displayName:u?l.categoryLabel:l.label,percentage:0,categoryIndex:u?d:void 0,seriesIndex:u?void 0:c},n[g]=p),p.percentage+=h}t=_.values(n);return d3.pie().startAngle(e).endAngle(a).sort(null).value(function(e){return e.percentage})(t)},x.prototype.getFirstElement=function(){var e,t=this.flattenViewModel();return _.isEmpty(t)?{element:null}:(e=t[0].categoryIndex,t=t[0].seriesIndex,{element:this.findHTMLElement(e,t)})},x.prototype.getNextDataPoint=function(e,t,a){var i=this.flattenViewModel(),i=R.NavigationUtils.getNextFromFlattenedViewModel(i,e,t,this.data.navigationStrategy,a);return{element:this.findHTMLElement(i.categoryIndex,i.seriesIndex)}},x.prototype.findHTMLElement=function(t,a){return this.mainGraphicsContext.selectAll(x.SliceClass.selector).filter(function(e){return e.data.categoryIndex===t&&e.data.seriesIndex===a}).node()},x.prototype.flattenViewModel=function(){return this.data.dataPoints.map(function(e){return{categoryIndex:e.data.categoryIndex,seriesIndex:e.data.seriesIndex}})},x.prototype.getDefaultDonutData=function(){return{dataPointsToDeprecate:[],dataPointsToEnumerate:[],dataPoints:[],unCulledDataPoints:[],legendData:R.Legend.getDefaultLegendData(this.style),hasHighlights:!1,highlightsOverflow:!1,dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),hasDynamicSeries:!1,hasNegativeValues:!1,allValuesAreNegative:!1,donutInnerRadiusRatio:this.isDonutChart?x.DefaultDonutInnerRadiusRatio:0,startAngle:x.DefaultStartAngleDegrees,navigationStrategy:null,explode:x.DefaultExplode,borderWidth:x.DefaultBorderWidth,borderColor:x.DefaultStrokeColorName,hasCategoryData:!1,hasSeriesData:!1}},x.prototype.init=function(e){var t,a=this,i=(this.options=e,this.featureSwitches=e.featureSwitches,e.element);i.empty(),this.parentViewport=e.viewport,this.currentViewport={height:e.viewport.height,width:e.viewport.width},this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.data=this.getDefaultDonutData(),this.radius=0,this.maxOffset=0,this.mobileInteractiveLegend=!(null==(t=e.interactivity)||!t.isInteractiveLegend),this.hostService=e.host,this.behavior&&(this.interactivityService=R.createInteractivityService(this.hostService)),this.legend=R.createLegend(i,this.mobileInteractiveLegend,this.interactivityService,this.isScrollable,void 0,this.style,this.hostService),this.tooltipService=R.createTooltipService(this.hostService),this.mobileInteractiveLegend&&(this.legendContainer=d3.select(i.get(0)).append("div").classed(x.LegendClass.class,!0),this.interactivityState={interactiveLegend:new r(this,this.legendContainer,this.colors,e),valueToAngleFactor:0,sliceAngles:[],currentRotate:0,interactiveChosenSliceFinishedSetting:!1,lastChosenInteractiveSliceIndex:0,totalDragAngleDifference:0,currentIndexDrag:0,previousIndexDrag:0,previousDragAngle:0,donutCenter:{x:0,y:0}}),this.featureSwitches.onObject&&(t=null!=(e=null==(t=this.hostService)?void 0:t.getSubSelectionService())?e:R.SubSelectionRegionOutlineRenderer.createWithDefaultHost(),this.subSelectionHelper=R.HtmlSubSelectionHelper.createHtmlSubselectionHelper({selectorCallback:function(e){return a.getSelectorsByColumnSubSelection(e)},customOutlineCallback:function(e){return a.getCustomSubSelectionOutlines(e)},hostElement:i.get(0),hostServices:this.hostService,renderer:t})),this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(x.ChartClass.class,!0),this.behavior&&(this.clearCatcher=R.appendClearCatcher(this.svg)),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed(x.SliceContainerClass.class,!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0).attr("aria-label",this.hostService.getLocalizedString("Visual_Plot")).attr("aria-multiselectable",!0).attr("role","listbox").classed(R.SetFocusRingClassName,!e)),this.labelBackgroundGraphicsContext=this.svg.append("g").classed(R.DataLabelViewModel.labelBackgroundGraphicsContextClass.class,!0),this.labelGraphicsContext=this.svg.append("g").classed(R.DataLabelViewModel.labelGraphicsContextClass.class,!0),this.pie=d3.pie().sort(null).value(function(e){return e.percentage})},x.prototype.update=function(e){var t=e.dataViews,a=e.formatMode,i=e.subSelections,r=e.suppressAnimations,n=e.type,e=e.viewport;this.parentViewport=e,this.featureSwitches.onObject&&(this.subSelectionHelper.setFormatMode(a),null!=(e=this.interactivityService))&&e.setFormatMode(a);n!==g.VisualUpdateType.Resize&&n!==g.VisualUpdateType.ResizeEnd&&(this.dataViews=t,0<(null==(e=this.dataViews)?void 0:e.length)&&this.dataViews[0].categorical?this.data=x.converter(this.dataViews[0],this.style,this.isDonutChart,a,this.parentViewport,this.disableGeometricCulling,this.interactivityService,this.tooltipsEnabled,this.featureSwitches):this.data=this.getDefaultDonutData()),this.mobileInteractiveLegend||this.renderLegend(a),this.initViewportDependantProperties(),this.updateDonutProperties(),this.updateInternal(this.data,r,a),this.dataViews&&(t=R.getInvalidValueWarnings(this.dataViews,!1,!1,!1,["Tooltips"]),this.data.allValuesAreNegative?t.push(new R.AllNegativeValuesWarning):this.data.hasNegativeValues&&t.push(new R.NegativeValuesNotSupportedWarning),this.hostService.setWarnings(t));e=n&g.VisualUpdateType.Data||n&g.VisualUpdateType.Resize||n&g.VisualUpdateType.FormattingSubSelectionChange;this.subSelectionHelper&&e&&(this.subSelectionHelper.updateOutlinesFromSubSelections(i,!0),r=n&g.VisualUpdateType.FormattingSubSelectionChange,this.hostService.alertScreenReader)&&r&&(t=(null==(a=this.subSelectionHelper.getLabelsFromSubSelections(i,["aria-label"]))?void 0:a.length)&&a.join(" "))&&this.hostService.alertScreenReader(t)},x.prototype.getLegendCard=function(){return R.Legend.getLegendFormattingModel({legendData:this.data.legendData},this.hostService,this.featureSwitches)},x.prototype.getSlicesCard=function(){var t,a,e,i,r=this;if(this.data)return t=R.donutChartObjectDescriptorProps.slices,a=function(e){return r.hostService.getLocalizedString(e)},e=[R.donutChartObjectDescriptorProps.dataPoint.fill,t.innerRadiusRatio,t.borderColor,t.borderWidth,t.explode],e=new R.builder.FormattingCardBuilder(new R.builder.FormattingCardUidBuilder("slices"),"Role_DisplayName_Slices",e,a),0<(i=R.LegendData.toIEnumerableDataPoints(this.data.legendData)).length&&e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors");e={groupBuilder:e,dataPoints:i,seriesColorProps:R.donutChartObjectDescriptorProps.dataPoint,localize:a,featureSwitches:r.featureSwitches};g.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(e)}),this.featureSwitches.pieChartMarginBetweenSlices?(0!==this.maxOffset&&this.data.explode>this.maxOffset&&(this.data.explode=this.maxOffset),e.addGroup("border",function(e){e.withDisplayName("Visual_Border").addSimpleSlice("borderColor",function(){var e={value:r.data.borderColor};return new n.ColorPickerBuilder({descriptor:t.borderColor,value:e}).build()}).addSimpleSlice("borderWidth",new n.SliderBuilder({descriptor:R.donutChartObjectDescriptorProps.slices.borderWidth,value:r.data.borderWidth,localize:a}).build())}),e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerRadius",new n.SliderBuilder({descriptor:t.innerRadiusRatio,value:Math.round(100*r.data.donutInnerRadiusRatio/x.OuterRadiusRatio),localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:99},unitSymbol:R.visualLocKeys.PercentLocKey}}).build()).addSimpleSlice("explode",new n.SliderBuilder({descriptor:t.explode,value:r.data.explode,localize:a}).build())})):this.isDonutChart&&e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerRadius",new n.SliderBuilder({descriptor:t.innerRadiusRatio,value:Math.round(100*r.data.donutInnerRadiusRatio/x.OuterRadiusRatio),localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:99},unitSymbol:R.visualLocKeys.PercentLocKey}}).build())}),e.build()},x.prototype.getDetailLabelsCard=function(){var t=this,e=__assign(__assign({},R.DataLabelViewModel.getDefaultDataLabelsProps("labels")),{position:R.donutChartObjectDescriptorProps.labels.position,overflow:R.donutChartObjectDescriptorProps.labels.overflow,background:R.donutChartObjectDescriptorProps.labels.background}),a=new n.FormattingCardBuilder(new n.FormattingCardUidBuilder("labels"),"Visual_DetailLabels",e,function(e){return t.hostService.getLocalizedString(e)});return R.DataLabelViewModel.getDataLabelsFormattingModel({cardBuilder:a,dataLabelsProps:e,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:{dataLabelsSettings:null!=(e=null==(a=this.data)?void 0:a.dataLabelsSettings)?e:x.getDefaultDonutLabelSettings(this.style),show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},omitDescription:!0,individualSelector:R.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:null!=_.first(this.data.legendData.dataPoints),hasDynamicSeries:this.data.hasDynamicSeries,hasSeriesSelector:!1})})},x.prototype.getRotationCard=function(){var t,e,a=this;if(this.data)return t=function(e){return a.hostService.getLocalizedString(e)},(e=new R.builder.FormattingCardBuilder(new R.builder.FormattingCardUidBuilder("rotation"),"Visual_BasicShape_Rotate",[R.donutChartObjectDescriptorProps.slices.startAngle],t)).addGroup("default",function(e){e.addSimpleSlice("rotation",new n.SliderBuilder({descriptor:R.donutChartObjectDescriptorProps.slices.startAngle,value:a.data.startAngle,options:{minValue:{type:0,value:0},maxValue:{type:1,value:360},unitSymbol:R.visualLocKeys.DegreeLocKey},localize:t}).build(),function(e){return e.withCustomDisplayName("Visual_BasicShape_Rotate")})}),e.build()},x.prototype.getFormattingModel=function(){var e=this;if(this.data)return new R.builder.FormattingModelBuilder(function(){return e.getLegendCard()},function(){return e.getSlicesCard()},function(){return e.getDetailLabelsCard()},function(){return e.getRotationCard()}).build()},x.prototype.enumerateObjectInstances=function(e){var t=new R.ObjectEnumerationBuilder;switch(e.objectName){case"legend":this.enumerateLegend(t);break;case"dataPoint":this.enumerateDataPoints(t);break;case"slices":this.enumerateSlices(t);break;case"labels":var a=null!=(a=null==(a=this.data)?void 0:a.dataLabelsSettings)?a:x.getDefaultDonutLabelSettings(this.style),i=a.position!==R.donutLabelPosition.outside;R.DataLabelViewModel.enumerateDataLabels({enumeration:t,dataLabelsSettings:a,show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},this.featureSwitches,{position:a.position,overflow:i?a.overflow:void 0,background:i?a.enableBackgroundWithAuto:void 0})}return t.complete()},x.prototype.enumerateDataPoints=function(e){this.data&&g.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:R.LegendData.toIEnumerableDataPoints(this.data.legendData)},this.featureSwitches)},x.prototype.enumerateLegend=function(e){this.data&&R.Legend.enumerate({enumeration:e,legendData:this.data.legendData},this.featureSwitches)},x.prototype.enumerateSlices=function(e){var t;this.data&&(t=this.featureSwitches.pieChartMarginBetweenSlices?(0!==this.donutProperties.maxOffset&&this.data.explode>this.donutProperties.maxOffset&&(this.data.explode=this.donutProperties.maxOffset),{selector:null,validValues:{explode:{numberRange:{min:0,max:this.donutProperties.maxOffset},unitSymbol:g.visuals.visualLocKeys.PercentLocKey}},properties:{innerRadiusRatio:Math.round(100*this.data.donutInnerRadiusRatio/x.OuterRadiusRatio),borderWidth:this.data.borderWidth,borderColor:this.data.borderColor,explode:this.data.explode,startAngle:this.data.startAngle},objectName:"slices"}):{selector:null,properties:{startAngle:this.data.startAngle,innerRadiusRatio:this.isDonutChart?Math.round(100*this.data.donutInnerRadiusRatio/x.OuterRadiusRatio):void 0},objectName:"slices"},e.pushInstance(t))},x.prototype.setInteractiveChosenSlice=function(e,t){var a,i,r,n=this;0!==this.interactivityState.sliceAngles.length&&(this.interactivityState.lastChosenInteractiveSliceIndex=e,this.interactivityState.interactiveChosenSliceFinishedSetting=!1,a=this.currentViewport,i=e%this.data.dataPoints.length,e=this.interactivityState.sliceAngles[i],(r=this.svg.select("g")).transition().duration(null!=t?t:s.animationDurationMs).ease(R.D3Helper.easeCompat(s.ease)).attr("transform",R.SVGUtil.translateAndRotate(a.width/2,a.height/2,0,0,e)).on("end",function(){n.interactivityState.interactiveChosenSliceFinishedSetting=!0}),this.interactivityState.currentRotate=e,this.interactivityState.interactiveLegend.updateLegend(i),this.svg.selectAll(x.SliceClass.selector).attr("opacity",function(e,t){return R.ColumnUtil.getFillOpacity(t===i,!1,!0,!1)}),R.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,r))},x.prototype.calculateRadius=function(){var e,t=this.currentViewport;return!this.mobileInteractiveLegend&&null!=(e=this.data)&&e.dataLabelsSettings.show?(e=t.height/t.width,e=2+1/(1+Math.exp(-5*(e-1))),Math.min(t.height,t.width)/e):Math.min(t.height,t.width)/2},x.prototype.getScaleForLegendArrow=function(){return this.maxHeightToScaleDonutLegend&&this.currentViewport.height<this.maxHeightToScaleDonutLegend?this.currentViewport.height/this.maxHeightToScaleDonutLegend:1},x.prototype.initViewportDependantProperties=function(t){function e(e){(a.mobileInteractiveLegend?e:e.transition().duration(t)).attr("transform",R.SVGUtil.translate(i.width/2,i.height/2))}var a=this,i=(void 0===t&&(t=0),this.currentViewport.height=this.parentViewport.height,this.currentViewport.width=this.parentViewport.width,this.currentViewport),r=(this.mobileInteractiveLegend?i.height-=x.InteractiveLegendContainerHeight:(r=this.legend.getMargins(),i.height-=r.height,i.width-=r.width),this.svg.attr("width",i.width).attr("height",i.height),this.mobileInteractiveLegend?(this.legendContainer.style("width","100%").style("height",x.InteractiveLegendContainerHeight+"px").style("overflow","hidden").style("top",0),this.svg.style("top",x.InteractiveLegendContainerHeight)):R.Legend.positionChartArea(this.svg,this.legend),this.previousRadius=this.radius,this.radius=this.calculateRadius(),this.radius*x.LabelRadiusRatio);this.outerArc=d3.arc(),this.labelArc=d3.arc().innerRadius(r).outerRadius(r-this.data.explode);e(this.mainGraphicsContext),e(this.labelGraphicsContext),e(this.labelBackgroundGraphicsContext),R.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,this.mainGraphicsContext,this.labelGraphicsContext,this.labelBackgroundGraphicsContext)},x.explodeXOffset=function(e,t){t=t.explode;return Math.sin(e)*t},x.explodeYOffset=function(e,t){t=t.explode;return-Math.cos(e)*t},x.prototype.updateDonutProperties=function(){var e,t=this.radius*x.LabelRadiusRatio,a=this.radius*x.OuterRadiusRatio-this.data.explode,i=this.radius*this.data.donutInnerRadiusRatio;2*a+5<Math.min(this.currentViewport.height,this.currentViewport.width)&&(e=Math.round(this.radius*x.OuterRadiusRatio-(this.data.explode+1)),e=Math.min(50,Math.max(0,e))),(Math.round(a-i)<x.MinDonutThickness||this.radius*x.OuterRadiusRatio+this.data.explode>t)&&(this.data.explode=0),this.donutProperties={viewport:this.currentViewport,outerArc:this.outerArc.innerRadius(0).outerRadius(i),labelArc:this.labelArc,dataLabelsSettings:this.data.dataLabelsSettings,innerRadius:i,outerRadius:a,labelRadius:t,startAngle:this.data.startAngle,explode:this.data.explode,maxOffset:e}},x.prototype.mergeDatasets=function(e,t){for(var a={},i=0,r=t;i<r.length;i++){var n=r[i],n=(n.identity?n:n.data).identity.getKey();a[n]=null}e=_.filter(e,function(e){return!((e.identity?e:e.data).identity.getKey()in a)}),e=_.map(e,function(e){e=g.Prototype.inherit(e);return void 0===e.percentage?e.data.percentage=0:e.percentage=0,e});return __spreadArray(__spreadArray([],t,!0),e,!0)},x.prototype.updateInternal=function(e,t,a){var i,r,n,s,o;this.animator?(i=this.getLayout(e),r=null!=(r=e.dataLabelsSettings)&&r.show?this.createLabels():[],s=o=void 0,t||(n=(o=this.animator.animate({viewModel:e,colors:this.colors,graphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,labelBackgroundContext:this.labelBackgroundGraphicsContext,interactivityService:this.interactivityService,layout:i,radius:this.radius,donutProperties:this.donutProperties,viewport:this.currentViewport,labels:r,style:this.style,formatMode:a,onObject:this.featureSwitches.onObject})).shapes,s=o.highlightShapes),(t||o.failed)&&(n=this.drawDefaultShapes(e,i,a),s=this.drawDefaultHighlightShapes(e,i),R.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:this.labelGraphicsContext,dataLabels:r,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext,twoRows:!0,hasTooltip:!0,formatMode:a,onObject:this.featureSwitches.onObject}),R.DataLabelRenderer.drawLabelLeaderLines(this.labelGraphicsContext,r)),this.assignInteractions(n,s,e,a)):(o=R.AnimatorCommon.GetAnimationDuration(this.animator,t),this.updateInternalToMove(e,o,this.style,a)),R.SVGUtil.flushAllD3TransitionsIfNeeded(this.options)},x.prototype.createLabels=function(){return new g.DonutLabelLayout(this.donutProperties).layout(this.createLabelDataPoints(),this.data.dataLabelsSettings,this.featureSwitches)},x.prototype.createLabelDataPoints=function(){var e=this.data,t=[],a=R.DataLabelViewModel.createColumnFormatterCacheManager(),i=null;0===e.dataLabelsSettings.displayUnits&&(i=d3.max(e.dataPoints,function(e){return Math.abs(e.data.measure)}));for(var r=0;r<this.data.dataPoints.length;r++){var n=this.createLabelDataPoint(e.dataPoints[r],i,a,this.featureSwitches);t.push(n)}return t},x.prototype.createLabelDataPoint=function(e,t,a,i){var r,n,s,o,l,d,c,h,u,g=this.labelArc.centroid(e),p=(e.startAngle+e.endAngle)/2,b=x.explodeXOffset(p,this.donutProperties),p=x.explodeYOffset(p,this.donutProperties),i=null!=i&&i.pieChartMarginBetweenSlices?(S=R.DonutLabelUtils.getXPositionForDonutLabel(g[0])-b,g[1]-p):(S=R.DonutLabelUtils.getXPositionForDonutLabel(g[0]),g[1]),g=this.data.dataLabelsSettings,i={point:{x:S,y:i},validPositions:[S<0?4:8],radius:0},S=R.ColorHelper.getThemeColor(this.style,R.DataLabelViewModel.DefaultLabelColorName),y=R.ColorHelper.getThemeColor(this.style,R.DataLabelViewModel.DefaultInsideLabelColorName),S=null!=(v=null!=(v=e.data.detailLabelFill)?v:S)?v:g.fontProperties.color,y=null!=(v=null!=(v=e.data.insideDetailLabelFill)?v:y)?v:g.fontProperties.color,v=R.DataLabelViewModel.getLabelStyleFlagType(g.labelStyle),f=g.fontProperties,m="",L=this.data.hasHighlights,C=this.data.highlightsOverflow;switch(D.hasFlag(v,R.labelStyle.flagLabelStyleData)&&(c=h=void 0,c=L&&!C?(h=e.data.originalHighlightValue,a.getOrCreate(e.data.highlightFormat,g,t)):(h=e.data.originalMeasure,a.getOrCreate(e.data.measureFormat,g,t)),l=null!=h?c.format(h):null,d=R.DataLabelViewModel.getTextSize(l,f)),D.hasFlag(v,R.labelStyle.flagLabelStyleCategory)&&(r=e.data.label,n=R.DataLabelViewModel.getTextSize(r,f)),D.hasFlag(v,R.labelStyle.flagLabelStylePercent)&&(c=R.valueFormatter.getLocalizedString("Percentage"),h=L&&!C?e.data.highlightPercentage:e.data.percentage,C=(L=_.clone(g)).percentagePrecision,L.displayUnits=0,u=_.isFinite(C)?(C=a.getOrCreate(c,L,null,L.percentagePrecision),null!=h?C.format(h):null):R.valueFormatter.format(h,c),s=R.DataLabelViewModel.getTextSize(u,f)),v){case w.categoryAndDataAndPercent:m=r,l&&(m=R.DataLabelViewModel.combineStrings([m,l]," ")),u&&(m=R.DataLabelViewModel.combineStrings([m,"(".concat(u,")")]," ")),o=R.DataLabelViewModel.getTextSize(m,f);break;case w.categoryAndData:m=r,l&&(m=R.DataLabelViewModel.combineStrings([m,l]," ")),o=R.DataLabelViewModel.getTextSize(m,f);break;case w.categoryAndPercent:m=r,u&&(m=R.DataLabelViewModel.combineStrings([m,u]," ")),o=R.DataLabelViewModel.getTextSize(m,f);break;case w.dataAndPercent:m=l,u&&(m=R.DataLabelViewModel.combineStrings([m,"(".concat(u,")")]," ")),o=R.DataLabelViewModel.getTextSize(m,f);break;case w.data:o=_.clone(d),m=l;break;case w.percent:o=_.clone(s),m=u;break;default:w.category;o=_.clone(n),m=r}a=R.DonutLabelUtils.getLabelLeaderLineForDonutChart(e,this.donutProperties,i.point,0,b,p,this.featureSwitches),L=R.DonutLabelUtils.getLabelLeaderLinesSizeForDonutChart(a);return{isPreferred:!0,text:"",tooltip:m,textSize:o,outsideFill:S,insideFill:y,fontProperties:f,identity:e.data.identity,parentShape:i,parentType:0,alternativeScale:t,donutArcDescriptor:e,angle:(e.endAngle+e.startAngle)/2,dataLabel:l,dataLabelSize:d,categoryLabel:r,categoryLabelSize:n,percentLabel:u,percentLabelSize:s,leaderLinePoints:a,linesSize:L,backgroundColor:g.backgroundColor,backgroundTransparency:g.backgroundTransparency}},x.prototype.renderLegend=function(e){var t;this.mobileInteractiveLegend||(this.data.legendObjectProperties?(null!=(t=this.data.legendData).position&&this.legend.setPosition(t.position),this.legend.drawLegend(t,this.parentViewport,{formatMode:e})):(this.legend.setPosition(R.LegendPosition.Top),this.legend.drawLegend(R.Legend.getDefaultLegendData(this.style),this.parentViewport,{formatMode:e})))},x.prototype.getSelectorsByColumnSubSelection=function(e){return"slices"!==d3.select(e).attr(R.SubSelectableObjectNameAttribute)?{}:(e=d3.select(e).datum(),this.getSelectorFromArcDescriptor(e))},x.prototype.getSelectorFromArcDescriptor=function(e){var e=e.data,t=e.categoryIndex,e=e.seriesIndex,a=this.data,i=a.legendData,r=a.hasCategoryData,a=a.hasDynamicSeries,r=r||!a?t:e,a=i.dataPoints;if(!_.isEmpty(a))return a[r].identity.getSelectorsByColumn()},x.prototype.getCustomSubSelectionOutlines=function(e){var i=this,e=e.visualObjects,e=_.reduce(e,function(e,t){var a;return"slices"===t.objectName&&(a=i.getSliceSubSelectionOutlines(t)),_.isEmpty(a)||e.push.apply(e,a),e},[]);return _.isEmpty(e)?void 0:e},x.prototype.getSliceSubSelectionOutlines=function(e){var t,a,i,r,n,s,o,l,d,c=this,h=e.selectorsByColumn,e=this.data.subSelectionDataPoints.find(function(e){return u.equalsSelectorsByColumn(c.getSelectorFromArcDescriptor(e),h)});if(e)return s=(n=this.donutProperties).innerRadius,n=n.outerRadius,t=e.startAngle,a=e.endAngle,i=(e=e.data).categoryIndex,e=e.seriesIndex,r=s*(s=this.parentViewport.scale),n=n*s,d=(s=this.mainGraphicsContext.node().getBoundingClientRect()).left,o=s.top,l=s.height,d={x:d+s.width/2,y:o+l/2},[{id:"category".concat(null!=i?i:-1,"-series").concat(null!=e?e:-1),outline:{type:4,center:d,innerRadius:r,outerRadius:n,startAngle:t,endAngle:a}}]},x.prototype.getSubSelectionStyles=function(e){if(this.featureSwitches.onObject){var t=_.first(e),e=t.visualObjects,e=e[0];switch(e.objectName){case"legend-title":return R.Legend.getLegendTitleSubSelectionStyles();case"legend-items":return R.Legend.getLegendItemsSubSelectionStyles(this.hostService);case"data-labels":return R.OnObjectUtil.getDataLabelsSubSelectionStyles({hostServices:this.hostService,omitSelectorForSingleSeries:!0,individualSelector:!0,selector:void 0,repetitionSelector:void 0,inContainer:!1});case"slices":return this.getSliceSubSelectionStyles(t)}}},x.prototype.getSliceSubSelectionStyles=function(e){var t=this,e=e.visualObjects,e=u.normalizeSelector(u.convertSelectorsByColumnToSelector(e[0].selectorsByColumn)),a="".concat("Visual","-").concat("slices"),i="".concat("slices","-").concat("colors"),r=g.colorEnumerationHelperModuleFactory().getSeriesColorSliceUid({dataPoint:void 0,featureSwitches:this.featureSwitches,groupUid:i,localize:function(e){return t.hostService.getLocalizedString(e)}});return{type:3,fill:{label:this.hostService.getLocalizedString("Visual_Fill"),reference:{cardUid:a,groupUid:i,sliceUid:r,selector:e}}}},x.prototype.getSubSelectionShortcuts=function(e,t){if(this.featureSwitches.onObject&&!t){t=_.first(e).visualObjects,t=t[0];switch(t.objectName){case"legend-title":return R.Legend.getLegendTitleShortcuts(this.hostService);case"legend-items":return R.Legend.getLegendItemsShortcuts({hostServices:this.hostService,showSort:!0});case"data-labels":return this.getDetailLabelShortcuts();case"slices":return this.getSliceShortcuts(e)}}},x.prototype.getSubSelectables=function(e){return this.subSelectionHelper.getAllSubSelectables(e)},x.prototype.getNextSubSelectable=function(e,t){return this.subSelectionHelper.getNextSubSelectable(e,t)},x.prototype.getDetailLabelShortcuts=function(){function e(e){return t.hostService.getLocalizedString(e)}var t=this,a="".concat("Visual","-").concat("labels");return[{type:0},{type:3,sourceUid:"".concat("labels","-").concat("options","-labelContents"),label:e("Visual_LabelContents")},{type:3,sourceUid:"".concat("labels","-").concat("options","-position"),label:e("Visual_Position")},{type:1,destinationUids:[{cardUid:a}],label:e("Format_Detail_Labels")}]},x.prototype.getSliceShortcuts=function(e){function t(e){return a.hostService.getLocalizedString(e)}var a=this,i="".concat("Visual","-").concat("slices"),r="".concat("Visual","-").concat("labels"),n="".concat("slices","-").concat("colors"),n=g.colorEnumerationHelperModuleFactory().getSeriesColorSliceUid({dataPoint:void 0,featureSwitches:this.featureSwitches,groupUid:n,localize:function(e){return a.hostService.getLocalizedString(e)}}),e=_.first(e).visualObjects;return[{type:0,relatedResetSourceUids:[{sourceUid:n,selector:u.normalizeSelector(u.convertSelectorsByColumnToSelector(e[0].selectorsByColumn))}],excludedResetSourceUids:[{sourceUid:r}]},{type:2,sourceUid:r,enabledLabel:t("Format_AddDetailLabels")},{type:1,destinationUids:[{cardUid:i}],label:t("Format_Slices")}]},x.prototype.addInteractiveLegendArrow=function(){var e,t,a;this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&(this.interactiveLegendArrow||((e=this.svg.append("g")).append("path").classed(x.LegendArrowClass.class,!0).attr("d","M1.5,2.6C0.65,1.15,1.85,0,3,0l27,0c1.65,0,2.35,1.15,1.5,2.6L18,26.45c-0.8,1.45-2.15,1.45-2.95,0L1.95,2.6z"),this.interactiveLegendArrow=e),e=this.getScaleForLegendArrow(),t=(this.currentViewport.height-2*this.radius)/2+11*e,a=this.currentViewport.width/2-16.5*e,this.interactiveLegendArrow.attr("transform",R.SVGUtil.translateAndScale(a,t,e)))},x.prototype.calculateSliceAngles=function(){var e=[],t=this.data.dataPoints;if(0===t.length)this.interactivityState.valueToAngleFactor=0,this.interactivityState.sliceAngles=[];else{for(var a=0,i=0,r=t.length;i<r;i++)a+=t[i].data.percentage;this.interactivityState.valueToAngleFactor=360/a;for(var n=0,i=0,r=t.length;i<r;i++){var s=t[i].data.percentage*this.interactivityState.valueToAngleFactor;e.push(s/2-(n+=s))}this.interactivityState.sliceAngles=e}},x.prototype.assignInteractions=function(e,t,a,i){var r,n;this.mobileInteractiveLegend?this.assignInteractiveChartInteractions(e):this.interactivityService&&(r=a.dataPoints.map(function(e){return e.data}),a={root:this.mainGraphicsContext,clearCatcher:this.clearCatcher,slices:e,highlightSlices:t,visual:this,hasHighlights:a.hasHighlights,visualInstanceId:this.hostService.instanceId},e.attr("tabindex",0).attr("focusable",!0),n={navigationStrategy:this.data.navigationStrategy,helper:this},this.interactivityService.bind(r,this.behavior,a,{navigationOptions:n,pointSourceKey:"donut"}),this.featureSwitches.onObject)&&this.interactivityService.setFormatMode(i),this.tooltipsEnabled&&this.addTooltips(e,t)},x.prototype.assignInteractiveChartInteractions=function(e){var a=this,t=this.svg.node().getBoundingClientRect(),t=(this.interactivityState.donutCenter={x:t.left+t.width/2,y:t.top+t.height/2},this.interactivityState.totalDragAngleDifference=0,this.interactivityState.currentRotate=0,this.interactivityState.interactiveChosenSliceFinishedSetting=!0,this.calculateSliceAngles(),e.on("click",function(e,t){d3.event.defaultPrevented||a.setInteractiveChosenSlice(t)}),d3.drag().on("start",this.interactiveDragStart).on("drag",this.interactiveDragMove).on("end",this.interactiveDragEnd));this.svg.style("touch-action","none").call(t)},x.prototype.getAngleFromDragEvent=function(){var e=this.interactivityState,t=d3.event.sourceEvent;if(-1!==t.type.toLowerCase().indexOf("touch")){if(1!==t.touches.length)return null;var a=t.touches[0],i=a.pageX,a=a.pageY}else i=t.pageX,a=t.pageY;t={x:i-e.donutCenter.x,y:-a+e.donutCenter.y};return 180*Math.atan2(t.y,t.x)/Math.PI},x.prototype.interactiveDragStart=function(){this.interactivityState.totalDragAngleDifference=0,this.interactivityState.previousDragAngle=this.getAngleFromDragEvent()},x.prototype.interactiveDragMove=function(){var e=this.data.dataPoints,a=this.interactivityState;if(!0===a.interactiveChosenSliceFinishedSetting){var t=this.getAngleFromDragEvent();if(t){for(var i=a.previousDragAngle-t,r=(a.totalDragAngleDifference+=i,a.previousDragAngle=t,a.currentRotate+=i,this.svg.select("g").attr("transform",R.SVGUtil.translateAndRotate(this.currentViewport.width/2,this.currentViewport.height/2,0,0,this.interactivityState.currentRotate)),e[0].data.percentage*a.valueToAngleFactor),n=a.currentRotate<=0?-1*a.currentRotate%360:360-a.currentRotate%360,s=(a.currentIndexDrag=0,e.length);a.currentIndexDrag<s&&r<n;)a.currentIndexDrag<s-1&&(r+=e[a.currentIndexDrag+1].data.percentage*a.valueToAngleFactor),a.currentIndexDrag++;a.currentIndexDrag!==a.previousIndexDrag&&(a.interactiveLegend.updateLegend(a.currentIndexDrag),this.svg.selectAll(x.SliceClass.selector).attr("opacity",function(e,t){return R.ColumnUtil.getFillOpacity(t===a.currentIndexDrag,!1,!0,!1)}),a.previousIndexDrag=a.currentIndexDrag)}}},x.prototype.interactiveDragEnd=function(){0!==this.interactivityState.totalDragAngleDifference&&(this.setInteractiveChosenSlice(this.interactivityState.currentIndexDrag),d3.event.sourceEvent.stopPropagation())},x.prototype.updateInternalToMove=function(t,e,a,i){var r,n,s,o,l=this.svg,d=this.pie,c=this.key,h=this.outerArc,u=this.radius,g=this.previousRadius,p=t.borderColor,b=this.donutProperties,S=this.svg.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data().map(function(e){return e.data}),S=(0===S.length&&(S=t.dataPointsToDeprecate),this.mergeDatasets(S,t.dataPointsToDeprecate)),y=l.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(d(t.dataPointsToDeprecate),c),S=(y.enter().insert("path").classed(x.SliceClass.class,!0).each(x.UpdateCurrentArcElementFunc),y=l.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(d(S),c),this.donutProperties.innerRadius);x.isSingleColor(t.dataPoints),h.innerRadius(S),a.isHighContrast||y.style("stroke-opacity",function(e){return R.ColumnUtil.getFillOpacity(e.data.selected,!1,!1,t.hasHighlights)}).style("stroke-dasharray",function(e){return x.drawStrokeForDonutChart(e,b)}),y.style("fill",function(e){return e.data.color}).style("fill-opacity",function(e){return R.ColumnUtil.getFillOpacity(e.data.selected,!1,!1,t.hasHighlights)}).style("stroke",p).style("stroke-width",function(e){return e.data.strokeWidth}).transition().duration(e).attrTween("d",function(e){var t=d3.interpolateObject(this._current,e),a=d3.interpolateNumber(g*x.OuterRadiusRatio,u*x.OuterRadiusRatio);return this._current=t(0),function(e){return h.outerRadius(a(e))(t(e))}}),(y=l.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(d(t.dataPointsToDeprecate),c)).exit().transition().delay(e).duration(0).remove(),this.mobileInteractiveLegend||(S=[],(n=t.dataLabelsSettings)&&n.show&&(S=this.createLabels()),R.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:this.labelGraphicsContext,dataLabels:S,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext,formatMode:i,onObject:this.featureSwitches.onObject}),R.DataLabelRenderer.drawLabelLeaderLines(this.labelGraphicsContext,S)),t.hasHighlights?(s=(n=l.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceHighlightClass.selector).data(d(t.dataPointsToDeprecate),c)).enter().insert("path").classed(x.SliceHighlightClass.class,!0).each(x.UpdateCurrentArcElementFunc).merge(n),x.isSingleColor(t.dataPoints),a.isHighContrast||s.style("stroke-opacity",1).style("stroke-dasharray",function(e){return x.drawStrokeForDonutChart(e,b,e.data.highlightRatio)}),o=this,s.style("fill",function(e){return e.data.color}).style("fill-opacity",1).style("stroke",p).style("stroke-width",function(e){return 0===e.data.highlightRatio?0:e.data.strokeWidth}).transition().duration(e).attrTween("d",function(e){var t=d3.interpolateObject(this._current,e),a=d3.interpolateNumber(g*x.OuterRadiusRatio,o.getHighlightRadius(e));return this._current=t(0),function(e){return h.outerRadius(a(e))(t(e))}}),r=n.exit().transition().delay(e).duration(0).remove()):l.selectAll("path"+x.SliceHighlightClass.selector).transition().delay(e).duration(0).remove(),this.assignInteractions(y,s,t,i),R.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,y,y.exit(),s,r),this.mobileInteractiveLegend&&(this.addInteractiveLegendArrow(),this.interactivityState.interactiveLegend.drawLegend(this.data.dataPointsToDeprecate),S=this.interactivityState.lastChosenInteractiveSliceIndex||0,this.setInteractiveChosenSlice(S,e))},x.prototype.addTooltips=function(e,t){this.tooltipService.addTooltip(e,function(e){return null==(e=e.data)?void 0:e.data.tooltipInfo},function(e){var t;return(null==(t=e.data)?void 0:t.data.identity)&&[e.data.data.identity]}),t&&this.tooltipService.addTooltip(t,function(e){return null==(e=e.data)?void 0:e.data.tooltipInfo},function(e){var t;return(null==(t=e.data)?void 0:t.data.identity)&&[e.data.data.identity]})},x.prototype.drawDefaultShapes=function(t,e,a){var i=this.svg.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(t.dataPoints,x.ArcDescriptorKeyFunc),r=null==(n=this.interactivityService)?void 0:n.hasSelection(),n=i.enter().insert("path").attr("class",x.SliceClass.class).merge(i);return x.isSingleColor(t.dataPoints),this.interactivityService&&n.attr("tabindex",function(e){return null!=e.data.measure?0:null}).attr("focusable",function(e){return null!=e.data.measure||null}).attr("aria-label",function(e){return e.data.formattedTooltip}).attr("role","option").classed(R.SetFocusRingClassName,!jsCommon.BrowserUtils.isInternetExplorerOrEdge()),n.style("fill",function(e){return e.data.color}).style("fill-opacity",function(e){return R.ColumnUtil.getFillOpacity(e.data.selected,!1,r,t.hasHighlights)}).style("stroke-opacity",function(e){return R.ColumnUtil.getFillOpacity(e.data.selected,!1,r,t.hasHighlights)}).style("stroke",t.borderColor).style("stroke-width",function(e){return e.data.strokeWidth}).attrs(e.shapeLayout.attrs).styles(e.shapeLayout.styles),i.exit().remove(),this.featureSwitches.onObject&&x.drawSubSelectionShapes(this.mainGraphicsContext,t,e,this.hostService,a),n},x.drawSubSelectionShapes=function(e,t,a,i,r){e=e.selectAll(R.SubSelectionSlicesClassAndSelector.selector).data(r?[{subSelectionDataPoints:t.subSelectionDataPoints}]:[]),t=e.enter().append("g").attr("class",R.SubSelectionSlicesClassAndSelector.class).merge(e),e.exit().remove(),e=t.selectAll("path".concat(R.SubSelectionSliceClassAndSelector.selector)).data(function(e){return e.subSelectionDataPoints}),t=e.enter().append("path").classed(R.SubSelectionSliceClassAndSelector.class,!0).merge(e);t.classed(R.HtmlSubSelectableClass,!!r).style("pointer-events","all").style("fill-opacity",0).attrs(((r={})[R.SubSelectableObjectNameAttribute]="slices",r[R.SubSelectableTypeAttribute]=3,r)).attrs(a.subSelectionShapeLayout.attrs),t.each(function(e){R.HtmlSubSelectionHelper.setDataForElement(this,{getDisplayName:function(){return i.getLocalizedString("MiniToolbar_Slice",e.data.displayName)}})}),e.exit().remove()},x.prototype.drawDefaultHighlightShapes=function(t,e){var a=this.svg.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceHighlightClass.selector).data(t.dataPoints.filter(function(e){return null!=e.data.highlightRatio}),x.ArcDescriptorKeyFunc),i=a.enter().insert("path").classed(x.SliceHighlightClass.class,!0).each(x.UpdateCurrentArcElementFunc).merge(a);return x.isSingleColor(t.dataPoints),i.style("fill",function(e){return e.data.color}).style("fill-opacity",function(e){return R.ColumnUtil.getFillOpacity(e.data.selected,!0,!1,t.hasHighlights)}).style("stroke-opacity",function(e){return R.ColumnUtil.getFillOpacity(e.data.selected,!0,!1,t.hasHighlights)}).style("stroke",R.ColorHelper.getThemeColor(this.style,x.DefaultStrokeColorName)).style("stroke-width",function(e){return 0===e.data.highlightRatio?0:e.data.strokeWidth}).attrs(e.highlightShapeLayout.attrs).styles(e.highlightShapeLayout.styles),a.exit().remove(),i},x.isSingleColor=function(e){var t;1<e.length&&(e[t=e.length-1].data.isLastInDonut=e[t].data.color===e[0].data.color)},x.drawStrokeForDonutChart=function(e,t,a){var i,a=t.outerRadius*(a=void 0===a?1:a),r=t.innerRadius,n=(e.endAngle-e.startAngle)*a;if(0<r){var t=t.outerRadius-r,s=(e.endAngle-e.startAngle)*r;if(e.data.highlightRatio&&(n=(e.endAngle-e.startAngle)*(t+r)),e.data.isLastInDonut)return"0 "+n+" "+t+" "+s+" "+t;s=n+t+s,i=t}else i=e.data.isLastInDonut?(s=n,2*a):(s=n+a,a);return"0 "+s+" "+i},x.prototype.onClearSelection=function(){var e;null!=(e=this.interactivityService)&&e.clearSelection()},x.prototype.onRestoreSelection=function(e){var t;return null!=(t=null==(t=this.interactivityService)?void 0:t.restoreSelection(e.selection))&&t},x.prototype.getLayout=function(e){var t=this,a=this.donutProperties,i=a.innerRadius,s=a.outerRadius,r=i||x.EffectiveZeroValue,o=d3.arc().innerRadius(i),e=d3.arc().innerRadius(i).outerRadius(s-e.explode),n=d3.arc().innerRadius(i).outerRadius(r),l=this;return{shapeLayout:{attrs:x.getStandardShapeLayoutAttrs(this.featureSwitches,e,a),styles:{"stroke-dasharray":this.featureSwitches.pieChartMarginBetweenSlices||this.style.isHighContrast?void 0:function(e){return x.drawStrokeForDonutChart(e,a)}}},highlightShapeLayout:{attrs:{d:function(e){return o.outerRadius(t.getHighlightRadius(e))(e)}},styles:{"stroke-dasharray":this.style.isHighContrast?void 0:function(e){return x.drawStrokeForDonutChart(e,a,e.data.highlightRatio)}}},subSelectionShapeLayout:{attrs:x.getStandardShapeLayoutAttrs(this.featureSwitches,e,a)},highlightShapeTween:function(n){return function(e){var t=0===n?s:l.getHighlightRadius(this._current),a=2===n?s:l.getHighlightRadius(e),i=d3.interpolateObject(this._current,e),r=d3.interpolateNumber(t,a);return this._current=i(0),function(e){return o.outerRadius(r(e))(i(e))}}},zeroShapeLayout:{attrs:{d:function(e){return n(e)}},styles:{"stroke-dasharray":this.style.isHighContrast?void 0:function(e){return x.drawStrokeForDonutChart(e,a,r)}}}}},x.getStandardShapeLayoutAttrs=function(e,t,a){return{d:function(e){return t(e)},transform:e.pieChartMarginBetweenSlices?function(e){e=(e.startAngle+e.endAngle)/2;return"translate("+x.explodeXOffset(e,a)+", "+x.explodeYOffset(e,a)+")"}:function(){return"translate(0, 0)"}}},x.prototype.getHighlightRadius=function(e){var t=this.donutProperties.innerRadius,a=this.donutProperties.outerRadius,e=null!=(e=null==(e=e.data)?void 0:e.highlightRatio)?e:1;return Math.sqrt(e*(a*a-t*t)+t*t)},x.prototype.getArcArea=function(e,t){var a=this.donutProperties.innerRadius,t=t?this.getHighlightRadius(e):this.donutProperties.outerRadius;return(e.endAngle-e.startAngle)*(t*t-a*a)},x.cullDataByViewport=function(e,t,a,i,r,n){for(var s,o=2*Math.PI,l=0,d=(72<e.length&&(a=Math.min(a.width,a.height)/2,l=x.InvisibleArcLengthInPixels/(a*o)*t),[]),c=0,h=e;c<h.length;c++){var u=h[c];u.measure>l&&(r=r===x.DefaultBorderWidth?i||s===u.color?1:0:r,u.strokeWidth=null!=n&&n.pieChartMarginBetweenSlices?r:i||s===u.color?1:0,s=u.color,d.push(u))}return d},x.getDefaultLabelSettings=function(e){return{show:!0,position:0,displayUnits:0,precision:R.DataLabelViewModel.defaultLabelPrecision,fontProperties:R.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",noColor:!0}).fontProperties,enableBackground:!0,backgroundColor:R.ColorHelper.getThemeColor(e,R.DataLabelViewModel.DefaultLabelBackgroundColorName),backgroundTransparency:.5}},x.ChartClass=e("donutChart"),x.LegendClass=e("donutLegend"),x.LegendArrowClass=e("donutLegendArrow"),x.SliceClass=e("slice"),x.SliceContainerClass=e("slices"),x.SliceHighlightClass=e("slice-highlight"),x.DefaultStrokeColorName="foregroundLight",x.OuterRadiusRatio=.8,x.LabelRadiusRatio=.9,x.DefaultDonutInnerRadiusRatio=.48,x.DefaultStartAngleDegrees=0,x.OnePiRadianInDegree=180,x.DefaultExplode=0,x.DefaultBorderWidth=0,x.MinDonutThickness=5,x.InvisibleArcLengthInPixels=1,x.InteractiveLegendContainerHeight=70,x.EffectiveZeroValue=1e-9,x.ArcDescriptorKeyFunc=function(e){return e.data.identity.getKey()},x);function x(e){e&&(this.isDonutChart=0!==e.sliceWidthRatio,this.animator=e.animator,this.isScrollable=e.isScrollable||!1,this.disableGeometricCulling=e.disableGeometricCulling||!1,this.behavior=e.behavior,this.tooltipsEnabled=e.tooltipsEnabled,e.smallViewPortProperties)&&(this.maxHeightToScaleDonutLegend=e.smallViewPortProperties.maxHeightToScaleDonutLegend)}R.DonutChart=M,b.prototype.drawLegend=function(e){function t(e,t){function a(e){return 0<d-e?(d-e)/2:0}e.attr("data-legend-index",t.index).css({position:"absolute",left:h});var i=R.valueFormatter.format(t.label),r=R.valueFormatter.format(t.originalMeasure,t.measureFormat),n=R.valueFormatter.format(t.percentage,"0.00 %;-0.00 %;0.00 %"),t=t.color,r=b.createBasicLegendItemSpan(b.LegendItemValueClassName,r,11),i=b.createBasicLegendItemSpan(b.LegendItemCategoryClassName,i,11),n=b.createBasicLegendItemSpan(b.LegendItemPercentageClassName,n,20),s=b.spanWidth(r),o=b.spanWidth(i),l=b.spanWidth(n),d=b.legendBoxSize(s,o,l),s=(e.css("width",d),c.maxLegendItemWidth=Math.max(c.maxLegendItemWidth,d),a(s)),o=a(o),l=a(l);b.createLegendItemSpan(i,o),b.createLegendItemSpan(r,s),b.createLegendItemSpan(n,l).css("color",t),e.append(i),e.append(n),e.append(r),c.legendItemsPositions.push({startX:h,boxWidth:d}),h+=d+b.ItemMargin}var c=this,e=(this.data=e,this.currentNumberOfLegendItems=e.length,this.currentIndex=0,this.leftMostIndex=0,this.rightMostIndex=e.length-1,this.legendContainerParent.select(b.LegendContainerSelector).empty()&&(this.legendContainer=this.legendContainerParent.append("div").classed(b.LegendContainerClassName,!0)),this.legendContainer.selectAll(b.LegendItemSelector).data(e)),a=this.legendContainerWidth=this.legendContainer.node().getBoundingClientRect().width,a=a/2-.4*a/2+b.ItemMargin,h=a;this.currentXOffset=a;e.enter().insert("div").classed(b.LegendItemClassName,!0).each(function(e){t($(this),e)}),e.exit().remove(),this.assignInteractions()},b.prototype.updateLegend=function(e){var t,a=this,i=this.legendContainerWidth,r=(this.currentIndex=e,this.updateLabelBlocks(e),-1*(this.legendItemsPositions[e].startX+this.legendItemsPositions[e].boxWidth/2-i/2)),e=(this.legendContainer.transition().styleTween("-webkit-transform",function(){return d3.interpolate(R.SVGUtil.translateWithPixels(a.currentXOffset,0),R.SVGUtil.translateWithPixels(r,0))}).styleTween("transform",function(){return d3.interpolate(R.SVGUtil.translateWithPixels(a.currentXOffset,0),R.SVGUtil.translateWithPixels(r,0))}).duration(s.animationDurationMs).ease(R.D3Helper.easeCompat(s.ease)).on("end",function(){a.currentXOffset=r}),this.legendContainer.selectAll(b.LegendItemSelector)),i=e.filter(function(e){return e.index===a.currentIndex}).data()[0].formattedTooltip;i&&null!=(t=null==(t=this.visualInitOptions)?void 0:t.host)&&t.alertScreenReader(i),e.exit(),R.SVGUtil.flushAllD3TransitionsIfNeeded(this.visualInitOptions,this.legendContainer)},b.prototype.assignInteractions=function(){var t=this,a=0,e=d3.drag().on("start",function(){a=0}).on("drag",function(){var e;a+=d3.event.dx,Math.abs(a)<t.maxLegendItemWidth||(e=a<0,t.dragLegend(e),a=0)});this.legendContainer.style("touch-action","none").style("cursor","pointer").call(e)},b.prototype.dragLegend=function(e){this.currentNumberOfLegendItems>b.MinimumItemsInLegendForCycled-1?this.currentIndex=this.getCyclingCurrentIndex(e):this.shouldChangeIndexInNonCycling(e)&&(e?this.currentIndex++:this.currentIndex--),this.donutChart.setInteractiveChosenSlice(this.currentIndex)},b.prototype.shouldChangeIndexInNonCycling=function(e){return!(0===this.currentIndex&&!e||this.currentIndex===this.currentNumberOfLegendItems-1&&e)},b.prototype.getCyclingCurrentIndex=function(e){var t=this.data.length,e=(this.currentIndex+(e?1:-1))%(t||1);return e<0?e+t:e},b.prototype.updateLegendItemsBlocks=function(e,t){var a,i,r=$(this.legendContainer.node());e?((a=r.find("[data-legend-index="+this.leftMostIndex+"]")).remove().insertAfter(r.find("[data-legend-index="+this.rightMostIndex+"]")),i=this.legendItemsPositions[this.rightMostIndex].startX+this.legendItemsPositions[this.rightMostIndex].boxWidth+b.ItemMargin,this.legendItemsPositions[this.leftMostIndex].startX=i,a.css("left",i),this.rightMostIndex=this.leftMostIndex,this.leftMostIndex=(this.leftMostIndex+1)%this.data.length):((a=r.find("[data-legend-index="+this.rightMostIndex+"]")).remove().insertBefore(r.find("[data-legend-index="+this.leftMostIndex+"]")),i=this.legendItemsPositions[this.leftMostIndex].startX-this.legendItemsPositions[this.rightMostIndex].boxWidth-b.ItemMargin,this.legendItemsPositions[this.rightMostIndex].startX=i,a.css("left",i),this.leftMostIndex=this.rightMostIndex,this.rightMostIndex=this.rightMostIndex-1==-1?this.legendItemsPositions.length-1:this.rightMostIndex-1),t-1!=0&&this.updateLegendItemsBlocks(e,t-1)},b.prototype.updateLabelBlocks=function(e){this.currentNumberOfLegendItems>b.MinimumItemsInLegendForCycled?(this.rightMostIndex===e&&this.updateLegendItemsBlocks(!0,2),this.leftMostIndex===e&&this.updateLegendItemsBlocks(!1,2),(this.rightMostIndex===e+1||0===this.rightMostIndex&&e===this.currentNumberOfLegendItems-1)&&this.updateLegendItemsBlocks(!0,1),(this.leftMostIndex===e-1||this.leftMostIndex===this.currentNumberOfLegendItems-1&&0===e)&&this.updateLegendItemsBlocks(!1,1)):this.currentNumberOfLegendItems===b.MinimumItemsInLegendForCycled&&(this.rightMostIndex===e&&this.updateLegendItemsBlocks(!0,1),this.leftMostIndex===e)&&this.updateLegendItemsBlocks(!1,1)},b.createBasicLegendItemSpan=function(e,t,a){return $("<span></span>").addClass(e).css({"white-space":"nowrap","font-size":a+"px"}).text(t)},b.createLegendItemSpan=function(e,t){return e.css({overflow:"hidden","text-overflow":"ellipsis",display:"inline-block",width:"100%","margin-left":t}),e},b.legendBoxSize=function(e,t,a){e=t<e?e:t;return b.MaxLegendItemBoxSize<(e=a<e?e:a)?b.MaxLegendItemBoxSize:e+2},b.spanWidth=function(e){return null==this.FakeElementSpan&&(this.FakeElementSpan=$("<span>").hide().appendTo(document.body)),this.FakeElementSpan.empty(),this.FakeElementSpan.append(e),this.FakeElementSpan.width()},b.LegendContainerClassName="legend-container",b.LegendContainerSelector=".legend-container",b.LegendItemClassName="legend-item",b.LegendItemSelector=".legend-item",b.LegendItemCategoryClassName="category",b.LegendItemPercentageClassName="percentage",b.LegendItemValueClassName="value",b.MaxLegendItemBoxSize=160,b.ItemMargin=30,b.MinimumItemsInLegendForCycled=3;var p,a,r=b;function b(e,t,a,i){this.maxLegendItemWidth=15,this.legendContainerParent=t,this.donutChart=e,this.visualInitOptions=i,this.legendItemsPositions=[]}function V(e,t,a,i){void 0===i&&(i=!0);var r=this.reader=g.data.createDataViewCategoricalReaderAdvanced(e,{staticSeriesRoleNames:["Y"],colorOptions:{valueRole:"Y",visualStyle:t},formatStringProp:R.donutChartProps.general.formatString}),n=r.data,s=(this.dataView=e).categorical,e=(this.dataViewMetadata=e.metadata,this.tooltipsEnabled=i,this.maxValue=0,this.hasNegativeValues=!1,this.allValuesAreNegative=!1,this.style=t,0<(null==(e=s.categories)?void 0:e.length)&&(i=s.categories[0],this.categoryValues=i.values,this.categoryFormatString=R.valueFormatter.getFormatString(i.source,R.donutChartProps.general.formatString)),this.hasDynamicSeries=r.columns.hasDynamicSeries(),this.hasSeriesData=n.hasSeries(),this.hasCategoryData=n.hasCategories(),this.highlightsOverflow=!1,this.total=0,this.highlightTotal=0,this.dataPoints=[],this.dataLabelsSettings=null,0),s=R.ColorHelper.create(t);if(this.borderColor=s.getColorForProperty(r.objects.getStaticObjects(),R.donutChartProps.slices.borderColor,M.DefaultStrokeColorName),this.explode=g.DataViewObjects.getValue(r.objects.getStaticObjects(),R.donutChartProps.slices.explode,M.DefaultExplode),this.borderWidth=g.DataViewObjects.getValue(r.objects.getStaticObjects(),R.donutChartProps.slices.borderWidth,M.DefaultBorderWidth),null==(e=g.DataViewObjects.getValue(r.objects.getStaticObjects(),R.donutChartProps.slices.innerRadiusRatio))?e=a?M.DefaultDonutInnerRadiusRatio:0:e/=100/M.OuterRadiusRatio,this.startAngle=g.DataViewObjects.getValue(r.objects.getStaticObjects(),R.donutChartProps.slices.startAngle,M.DefaultStartAngleDegrees),this.donutInnerRadiusRatio=e,n.hasValues("Y")){var o=this.seriesCount=n.getSeriesCount(),l=(this.hasHighlights=n.hasHighlights(),n.getCategoryCount()||1);this.allValuesAreNegative=void 0;for(var d=0;d<l;d++)for(var c=0;c<o;c++){var h=n.getValue("Y",d,c),u=void 0;this.hasHighlights&&null==(u=n.getHighlight("Y",d,c))&&(u=0),void 0===this.allValuesAreNegative?this.allValuesAreNegative=(!this.hasHighlights||u<=0)&&h<=0:this.allValuesAreNegative=this.allValuesAreNegative&&(!this.hasHighlights||u<=0)&&h<=0,this.hasNegativeValues||(this.hasNegativeValues=h<0||!!this.hasHighlights&&u<0)}this.allValuesAreNegative=!!this.allValuesAreNegative;for(d=0;d<l;d++)for(c=0;c<o;c++){h=n.getValue("Y",d,c);h=V.normalizedValue(h,this.allValuesAreNegative),this.total+=h,this.hasHighlights&&(u=n.getHighlight("Y",d,c),u=V.normalizedValue(u,this.allValuesAreNegative),this.highlightTotal+=u,!this.highlightsOverflow)&&g.Double.greaterWithPrecision(u,h,g.Double.getPrecision(Math.min(u,h)))&&(this.highlightsOverflow=!0)}}}a=p=p||{},V.normalizedValue=function(e,t){return null==e||isNaN(e)?0:e===Number.POSITIVE_INFINITY?Number.MAX_VALUE:e===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:t?Math.abs(e):e<0?0:e},V.prototype.convert=function(){for(var e=this,t=this.reader,a=this.reader.data,i=0===e.total?[]:e.categoryValues?e.convertCategoricalWithSlicing():e.hasDynamicSeries?e.convertSeries():e.convertMeasures(),r=(this.dataLabelsSettings=this.convertDataLabelSettings(),null!=(e=this.dataViewMetadata)&&e.objects&&(this.legendObjectProperties=null==(e=this.dataViewMetadata)?void 0:e.objects.legend),_.isEmpty(this.dataView.categorical.categories)?null:this.dataView.categorical.categories[0]),n=(this.dataPoints=[],R.donutChartProps.general.formatString),s=R.valueFormatter.getLocalizedString("Percentage"),o=null!=(e=this.dataLabelsSettings.fontProperties.color)?e:R.ColorHelper.getThemeColor(this.style,R.DataLabelViewModel.DefaultLabelColorName),l=null!=(e=this.dataLabelsSettings.fontProperties.color)?e:R.ColorHelper.getThemeColor(this.style,R.DataLabelViewModel.DefaultInsideLabelColorName),d=0,c=i.length;d<c;d++){var h=i[d],u=h.measure,g=V.normalizedValue(h.measure,this.allValuesAreNegative),p=h.highlightMeasure,b=V.normalizedValue(h.highlightMeasure,this.allValuesAreNegative),S=0<this.total?g/this.total:0,y=void 0,v=void 0,f=(g>this.maxValue&&(this.maxValue=g),b>this.maxValue&&(this.maxValue=b),this.hasHighlights&&(y=this.highlightsOverflow?(u=p,g=b,S=0<this.highlightTotal?b/this.highlightTotal:0,1):0!==g?b/g:0,v=S*(y=y||M.EffectiveZeroValue)),h.categoryLabel),m=this.dataView.categorical,L=void 0,L=null!=h.seriesIndex?h.seriesIndex:d,L=t.columns.getValueMetadataColumn("Y",L),C=this.hasHighlights&&this.highlightsOverflow?p:u,D=h.measureFormat||R.valueFormatter.getFormatString(L,n),w=this.hasHighlights&&!this.highlightsOverflow?p:void 0,x=h.highlightMeasureFormat||R.valueFormatter.getFormatString(L,n),P=R.valueFormatter.format(S,s),I=void 0,C=(null!=C&&null!=P&&(I=R.valueFormatter.format(C,D)+" ("+P+")"),void 0),P=(null!=w&&null!=v&&(D=R.valueFormatter.format(v,s),C=R.valueFormatter.format(w,x)+" ("+D+")"),void 0),w=(this.tooltipsEnabled&&(P=[],r&&P.push({displayName:r.source.displayName,value:f}),!this.hasDynamicSeries||r&&r.source===m.values.source||P.push({displayName:m.values.source.displayName,value:h.label}),null!=I&&P.push({displayName:L.displayName,value:I}),null!=C&&P.push({displayName:R.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:C}),R.TooltipBuilder.addTooltipMeasures(t,P,this.categoryValues?h.categoryIndex:0,this.hasDynamicSeries?h.seriesIndex:void 0,n)),this.style.isHighContrast||A===h.color&&S&&0<S?1:0),A=S&&0<S?h.color:A,x=R.DataLabelUtil.determineDataLabelFillColor({defaultColor:o,categoricalDataReader:t,categoryIndex:h.categoryIndex,seriesIndex:h.seriesIndex}),D=R.DataLabelUtil.determineDataLabelFillColor({defaultColor:l,categoricalDataReader:t,categoryIndex:h.categoryIndex,seriesIndex:h.seriesIndex}),f=R.DataLabelUtil.isAssignedColor(x)?x.color:void 0,m=(f&&(this.dataLabelsSettings.fontProperties=R.DataLabelUtil.updateFontPropertiesColor(f,this.dataLabelsSettings.fontProperties)),this.hasHighlights&&!this.highlightsOverflow);this.dataPoints.push({identity:h.identity,measure:g,originalMeasure:u,measureFormat:null!=(I=h.measureFormat)?I:L.format,percentage:S,index:h.index,label:h.label,highlightRatio:y,highlightValue:m?b:void 0,originalHighlightValue:m?p:void 0,highlightFormat:m?null!=(C=h.highlightMeasureFormat)?C:L.format:void 0,highlightPercentage:m?v:void 0,selected:!1,tooltipInfo:P,formattedTooltip:R.tooltipUtils.formatTooltipInfo(P),color:h.color,strokeWidth:w,seriesIndex:h.seriesIndex||0,categoryIndex:h.categoryIndex||0,detailLabelFill:x.color||void 0,insideDetailLabelFill:D.color||void 0,categoryLabel:h.categoryLabel})}a.hasCategoryWithRole("Category")?this.legendData=R.Legend.buildCategoryLegendData({dataView:this.dataView,categoryRole:"Category",style:this.style,valueRole:"Y",showByDefault:!1}):this.legendData=R.Legend.buildSeriesLegendData({dataView:this.dataView,staticSeriesRoleNames:["Y"],style:this.style,showByDefault:!1})},V.prototype.convertCategoricalWithSlicing=function(){for(var e=this.reader,t=this.reader.data,a=this.dataView.categorical,i=R.donutChartProps.general.formatString,r=[],n=0,s=this.categoryValues.length;n<s;n++)for(var o=this.categoryValues[n],l=e.colors.createByCategory(n),d=R.valueFormatter.format(o,this.categoryFormatString),c=0;c<this.seriesCount;c++){var h,u,g,p,b,S=t.getValue("Y",n,c),y=t.getFormatString("Y",n,c),v=this.hasHighlights?t.getHighlight("Y",n,c):void 0,f=this.hasHighlights?t.getHighlightFormatString("Y",n,c):void 0;null==S&&null==v||(h=e.columns.getValueColumn("Y",c),b=a.values.grouped()[c],u=d,(this.hasDynamicSeries||1<t.getSeriesCount())&&(u=R.converterHelper.getFormattedLegendLabel(h.source,a.values,i)),g=h.source.queryName,p=R.SelectionIdBuilder.builder().withCategory([a.categories[0]],n,null==(p=null==(p=a.categories[0])?void 0:p.source)?void 0:p.queryName,!0).withSeries(a.values,this.hasDynamicSeries?b:void 0,!0).withMeasure(g,h,n).createSelectionId(),b=R.valueFormatter.getFormatString(h.source,i,!0),r.push({identity:p,measureFormat:y||b,measure:S,highlightMeasureFormat:null!=f?f:b,highlightMeasure:v,index:r.length,label:u,categoryLabel:d,color:l,categoryIndex:n,seriesIndex:c}))}return r},V.prototype.convertMeasures=function(){for(var e=this.reader,t=[],a=R.donutChartProps.general.formatString,i=0;i<this.seriesCount;i++){var r=e.data.getValue("Y",0,i),n=e.data.getFormatString("Y",0,i),s=this.hasHighlights?e.data.getHighlight("Y",0,i):void 0,o=this.hasHighlights?e.data.getHighlightFormatString("Y",0,i):void 0,l=e.columns.getValueColumn("Y",i),d=R.valueFormatter.getFormatString(l.source,a,!0),c=l.source.displayName,l=R.SelectionId.createWithMeasure(l.source.queryName),h=e.colors.createBySeries(i);t.push({identity:l,measureFormat:n||d,measure:r,highlightMeasure:s,highlightMeasureFormat:o||d,index:i,label:c,categoryLabel:c,color:h,categoryIndex:i,seriesIndex:null})}return t},V.prototype.convertSeries=function(){for(var e=this.reader,t=this.dataView.categorical,a=[],i=R.donutChartProps.general.formatString,r=0;r<this.seriesCount;r++){var n=e.data.getValue("Y",0,r),s=e.data.getFormatString("Y",0,r),o=this.hasHighlights?e.data.getHighlight("Y",0,r):void 0,l=this.hasHighlights?e.data.getHighlightFormatString("Y",0,r):void 0,d=e.columns.getValueColumn("Y",r),c=t.values.grouped()[r],h=R.valueFormatter.getFormatString(d.source,i,!0),u=R.converterHelper.getFormattedLegendLabel(d.source,t.values,i),c=(new R.SelectionIdBuilder).withSeries(t.values,c,!0).withMeasure(d.source.queryName,d,0).createSelectionId(),d=e.colors.createBySeries(r);a.push({identity:c,measureFormat:s||h,measure:n,highlightMeasure:o,highlightMeasureFormat:null!=l?l:h,index:r,label:u,categoryLabel:u,color:d,categoryIndex:0,seriesIndex:r})}return a},V.prototype.convertDataLabelSettings=function(){var e,t=this.dataViewMetadata,a=M.getDefaultDonutLabelSettings(this.style);return t&&((t=t.objects)&&(e=t.labels)&&R.DataLabelViewModel.updateLabelSettingsFromLabelsObject(e,a,void 0,this.style),a.position=g.DataViewObjects.getValue(t,R.donutChartProps.labels.position,R.donutLabelPosition.outside),a.overflow=g.DataViewObjects.getValue(t,R.donutChartProps.labels.overflow,!0),a.enableBackgroundWithAuto=g.DataViewObjects.getValue(t,R.donutChartProps.labels.background,R.donutLabelBackground.auto)),a},a.DonutChartConverter=V}(powerbi=powerbi||{}),function(e){var c,t;function h(e){return t.call(this,e)||this}c=e.visuals||(e.visuals={}),t=c.BaseAnimator,__extends(h,t),h.prototype.animate=function(a){var e,t,i,r,n,s,o,l,d=this;return a.viewModel.highlightsOverflow||!this.previousViewModel||this.previousViewModel.highlightsOverflow||(t=null==(t=this.previousViewModel)?void 0:t.hasHighlights,null==(e=(e=a.viewModel.hasHighlights)&&!t?0:e&&t?1:!e&&t?2:void 0))?(this.previousViewModel=a.viewModel,h.FailedResult):(t=function(e){return e.style("fill",function(e){var t;return null!=(t=e.data.color)?t:a.colors.getNewColorScale().getColor(e.data.identity.getKey()).value}).style("stroke",c.ColorHelper.getThemeColor(a.style,c.DonutChart.DefaultStrokeColorName)).style("stroke-width",function(e){return e.data.strokeWidth})},i=function(e,t){return e.style("fill-opacity",t).style("stroke-opacity",t)},r=function(e){return e.transition().duration(d.animationDuration)},n=(o=(l=function(e,t){c.DonutChart.isSingleColor(e);e=a.graphicsContext.select(c.DonutChart.SliceContainerClass.selector).selectAll(t.selector).data(e,c.DonutChart.ArcDescriptorKeyFunc);return{updated:e.enter().insert("path").classed(t.class,!0).each(c.DonutChart.UpdateCurrentArcElementFunc).merge(e),removed:e.exit()}})(a.viewModel.dataPoints,c.DonutChart.SliceClass)).updated,o=o.removed,t(n),i(n,2===e?function(e){return c.ColumnUtil.getFillOpacity(e.data.selected,!1,e.data.selected,!e.data.selected)}:function(e){return c.ColumnUtil.getFillOpacity(e.data.selected,!1,!1,a.viewModel.hasHighlights)}),s=r(n).attrs(a.layout.shapeLayout.attrs).styles(a.layout.shapeLayout.styles),2===e&&i(s=s.transition().duration(0),function(e){return c.ColumnUtil.getFillOpacity(e.data.selected,!1,null==(e=a.interactivityService)?void 0:e.hasSelection(),!1)}),o.remove(),o=(s=l(a.viewModel.dataPoints.filter(function(e){return null!=e.data.highlightRatio}),c.DonutChart.SliceHighlightClass)).updated,l=s.removed,(2===e?(t(l),i(l,function(){return c.ColumnUtil.getFillOpacity(!1,!0,!1,!0)}),r(l).attrTween("d",a.layout.highlightShapeTween(e)).styles((null!=(s=a.interactivityService)&&s.hasSelection()?a.layout.zeroShapeLayout:a.layout.shapeLayout).styles)):(t(o),i(o,function(e){return c.ColumnUtil.getFillOpacity(e.data.selected,!0,null==(e=a.interactivityService)?void 0:e.hasSelection(),a.viewModel.hasHighlights)}),0===e&&o.attrs(a.layout.shapeLayout.attrs).styles(a.layout.shapeLayout.styles),r(o).attrTween("d",a.layout.highlightShapeTween(e)).styles(a.layout.highlightShapeLayout.styles),l)).remove(),c.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:a.labelGraphicsContext,backgroundContext:a.labelBackgroundContext,dataLabels:a.labels,hasTooltip:!0,numeric:!1,twoRows:!0,formatMode:a.formatMode,onObject:a.onObject}),c.DataLabelRenderer.drawLabelLeaderLines(a.labelGraphicsContext,a.labels),this.previousViewModel=a.viewModel,{failed:!1,shapes:n,highlightShapes:o})},h.FailedResult={failed:!0,shapes:null,highlightShapes:null},c.WebDonutChartAnimator=h}(powerbi=powerbi||{}),function(e){var r,n;function t(){}r=e.visuals||(e.visuals={}),n=jsCommon.BrowserUtils,t.prototype.bindEvents=function(e,t,a,i){this.root=e.root,this.slices=e.slices,this.highlightSlices=e.highlightSlices,this.hasHighlights=e.hasHighlights,this.visualInstanceId=e.visualInstanceId;e=e.clearCatcher;i?(r.InteractivityUtils.removeStandardInteractivityHandlers(this.slices),this.highlightSlices&&r.InteractivityUtils.removeStandardInteractivityHandlers(this.highlightSlices),r.InteractivityUtils.removeClearCatcherShortcut(this.root),r.InteractivityUtils.removeUseElementForFocus(this.root),r.InteractivityUtils.removeEnterPlotAreaHandler(this.root),r.InteractivityUtils.removeDataPointNavigationHandler(this.slices),e.on("click",null)):(r.InteractivityUtils.registerStandardInteractivityHandlers(this.slices,t),this.highlightSlices&&r.InteractivityUtils.registerStandardInteractivityHandlers(this.highlightSlices,t),a&&(i=a.dataPointNavigationManager,a=a.pointSourceKey,i.isEmpty(a)||(r.InteractivityUtils.registerClearCatcherShortcut(this.root,t),r.InteractivityUtils.appendUseElementForFocus(this.root,this.visualInstanceId,a),r.InteractivityUtils.registerEnterPlotAreaHandler(this.root,i,a),r.InteractivityUtils.registerDataPointNavigationHandler(this.slices,i,a))),e.on("click",function(){var e=d3.event;n.isCtrlOrMeta(e)||t.handleClearSelection()}))},t.prototype.renderFocus=function(e){var t="".concat(r.CurrentFocusDataPointId,"-").concat(this.visualInstanceId);this.root.select("#"+t).attr("id",null),e&&(e.setAttribute("id",t),n.focus(e))},t.prototype.renderSelection=function(t){var a=this.hasHighlights;this.slices.style("fill-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.data.selected,!1,t,a)}).style("stroke-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.data.selected,!1,t,a)}).attr("aria-selected",function(e){return e.data.selected}),this.highlightSlices&&this.highlightSlices.style("fill-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.data.selected,!0,t,a)}).style("stroke-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.data.selected,!0,t,a)})},r.DonutChartWebBehavior=t}(powerbi=powerbi||{}),function(v){var S=v.visuals.donutLabelBackground,p=v.visuals.donutLabelPosition,f=v.visuals.DonutLabelUtils,y=jsCommon.EnumExtensions,m=v.visuals.FontProperties,L=v.visuals.labelStyle,C=v.visuals.DataLabelViewModel,D=L.labelStyleFlagEnum,w=v.visuals.DonutChart,b=[L.categoryAndDataAndPercent,L.categoryAndData,L.categoryAndPercent,L.dataAndPercent],x=[0,1,2,3,4];function h(e){this.donutChartProperties=e,this.center={x:e.viewport.width/2,y:e.viewport.height/2},this.labelRadius=this.donutChartProperties.labelRadius;e=m.toTextProperties(e.dataLabelsSettings.fontProperties);this.additionalParenthesesWidth=v.TextMeasurementService.measureSvgTextWidth(e,"()"),this.additionalSpaceWidth=v.TextMeasurementService.measureSvgTextWidth(e," "),this.ellipsisWidth=v.TextMeasurementService.measureSvgTextWidth(e,"")}h.prototype.layout=function(e,t,a){for(var i=[],r=0,n=e;r<n.length;r++){var s=n[r];i.push({labelDataPoint:s,hasBeenRendered:!1,labelSize:s.textSize})}for(var o=[],l=[],d=this.donutChartProperties.viewport,c={labelDataPoints:i,maxNumberOfLabels:e.length},c=new v.LabelArrangeGrid([c],d),h=i.length-1;0<=h;h--)i[h].labelDataPoint.isPreferred&&(l=i.splice(h,1).concat(l));return 0<l.length&&(o=this.positionLabels(l,c,t,a)),0<e.length&&(d=this.positionLabels(i,c,t,a),o=o.concat(d)),_.filter(o,function(e){return e.isVisible})},h.prototype.positionLabels=function(s,o,i,a){function e(e){for(var t=0,a=s;t<a.length;t++){var i,r,n=a[t];n.hasBeenRendered||(i=e(n,o))&&(r=i.label)&&(i.overflows&&(c=!0),n.hasBeenRendered=!0,d.push(r))}}function t(){e(function(e,t){return{label:n.tryOutsidePositionForDonut(e,t,i,a),overflows:!0}})}function r(){e(function(e,t){var a;return _.includes(b,n.donutChartProperties.dataLabelsSettings.labelStyle)?(a=n.splitDonutDataPoint(e,n.donutChartProperties.dataLabelsSettings.labelStyle),n.tryInsidePositionForDonut(a,n.donutChartProperties,t,i)):n.tryInsidePositionForDonut(e,n.donutChartProperties,t,i)})}var n=this,l=null==i.position?p.outside:i.position,d=[],c=!1;switch(l){case p.outside:t();break;case p.inside:r();break;case p.preferOutside:t(),r();break;case p.preferInside:r(),t()}if(c&&i.enableBackgroundWithAuto===S.auto)for(var h=0,u=d;h<u.length;h++){var g=u[h];g.outside||(g.hasBackground=!0)}return d},h.prototype.tryOutsidePositionForDonut=function(e,t,a,i){var r=e.labelDataPoint.parentShape;if(!_.isEmpty(r.validPositions)&&0!==r.validPositions[0]){var r=r.validPositions[0],n=this.tryAllOutsidePositions(e,t,r,i);if(n&&0===n.score)return this.buildLabel(n,t,!0,a);if(_.includes(b,this.donutChartProperties.dataLabelsSettings.labelStyle)){e=this.splitDonutDataPoint(e,this.donutChartProperties.dataLabelsSettings.labelStyle),e=this.tryAllOutsidePositions(e,t,r,i);if(e&&(!n||e.score<n.score))return this.buildLabel(e,t,!0,a)}return n?this.buildLabel(n,t,!0,a):void 0}},h.prototype.tryInsidePositionForDonut=function(e,t,a,i){e=this.tryAllInsidePositions(e,t,a,i.overflow);if(e)return{label:this.buildLabel(e,a,!1,i),overflows:e.overflows}},h.prototype.generateCandidate=function(e,t,a,i){var r=e.labelDataPoint,t=h.generateCandidateAngleForPosition(r.donutArcDescriptor,t),n=this.getPointPositionForAngle(t),s=n.point,o=this.score(r,s),l=(r.donutArcDescriptor.startAngle+r.donutArcDescriptor.endAngle)/2,d=w.explodeXOffset(l,this.donutChartProperties),l=w.explodeYOffset(l,this.donutChartProperties),s=f.getLabelLeaderLineForDonutChart(r.donutArcDescriptor,this.donutChartProperties,s,t,d,l,i),t=f.getLabelLeaderLinesSizeForDonutChart(s),d=_.clone(r);return d.parentShape=n,d.leaderLinePoints=s,d.linesSize=t,{point:n,score:o,labelRects:h.tryPositionPoint(a,n.validPositions[0],d,this.center,this.donutChartProperties.viewport,0,i),donutLabelDataPointLayoutInfo:{labelDataPoint:d,hasBeenRendered:e.hasBeenRendered,labelSize:e.labelSize},renderLeaderLines:!0,overflows:!1}},h.prototype.tryAllOutsidePositions=function(e,t,a,i){var r=e.labelDataPoint,n=this.donutChartProperties.explode,a=h.tryPositionPoint(t,a,r,this.center,this.donutChartProperties.viewport,n,i),n=r.parentShape,n={point:n,score:this.score(r,n.point),labelRects:a,donutLabelDataPointLayoutInfo:e,renderLeaderLines:!0,overflows:!1};if(a&&a.textRect&&0===n.score)return n;var s,o=[];a&&a.textRect?(o=h.getLabelPointPositions(r.parentShape,!0),s=n):o=h.getLabelPointPositions(r.parentShape,!1);for(var l=0,d=o;l<d.length;l++){var c=d[l],c=this.generateCandidate(e,c,t,i);if(c.labelRects&&c.labelRects.textRect&&(null==s||c.score<s.score)&&0===(s=c).score)return s}return s},h.prototype.tryAllInsidePositions=function(e,t,a,i){for(var r,n,s,o,l=e.labelDataPoint.angle,d=(t.innerRadius+t.outerRadius)/2,c=w.explodeXOffset(l,t),h=w.explodeYOffset(l,t),u=0,g=x;u<g.length;u++){var p=this.getInsidePosition(e,t,l,d,g[u]),b=this.score(e.labelDataPoint,p),p={point:p,radius:0,validPositions:[256]},S=v.DataLabelPointPositioner.getLabelRect(e.labelDataPoint.textSize,p,256,0),y=void 0,y=0===t.explode?{left:S.left+this.center.x,top:S.top+this.center.y,width:S.width,height:S.height}:{left:S.left+this.center.x+c,top:S.top+this.center.y+h,width:S.width,height:S.height},S=!f.canLabelFit(e.labelDataPoint.donutArcDescriptor,t,S);!(null==s||s<b)||a.hasConflict(y)||!i&&S||(r=p,n=y,s=b,o=S)}if(r)return{point:r,score:0,labelRects:{textRect:n,diagonalLineRect:null,horizontalLineRect:null},donutLabelDataPointLayoutInfo:e,renderLeaderLines:!1,overflows:o}},h.prototype.getInsidePosition=function(e,t,a,i,r){var n=i,s=a;switch(r){case 0:break;case 1:n=i+.25*(t.outerRadius-t.innerRadius);break;case 2:n=i-.25*(t.outerRadius-t.innerRadius);break;case 3:s=a+.25*(e.labelDataPoint.donutArcDescriptor.endAngle-e.labelDataPoint.donutArcDescriptor.startAngle);break;case 4:s=a-.25*(e.labelDataPoint.donutArcDescriptor.endAngle-e.labelDataPoint.donutArcDescriptor.startAngle)}return f.getLabelPosition(s,n)},h.prototype.buildLabel=function(e,t,a,i){var r,n,s=e.labelRects.textRect,o=e.labelRects.horizontalLineRect,l=e.labelRects.diagonalLineRect,d=e.donutLabelDataPointLayoutInfo.labelDataPoint,o=(null==d.categoryLabel&&null==d.dataLabel&&null==d.percentLabel||(r=!0),t.add(s),o&&t.add(o),l&&t.add(l),s.top-this.center.y),t=s.left-this.center.x;switch(a&&(t<0?t+=s.width/2:t-=s.width/2),e.point.validPositions[0]){case 8:n="start";break;case 4:n="end";break;case 256:n="middle"}var c,h,u,g,l={left:t,top:o,height:s.height,width:s.width},t=C.getLabelStyleFlagType(this.donutChartProperties.dataLabelsSettings.labelStyle),o=f.getSpaceAvailableForDonutLabels(d.parentShape.point.x,this.donutChartProperties.viewport),p=o,s=v.visuals.DataLabelViewModel.getLabelTailoredText;if(t===L.labelStyleFlagEnum.categoryAndDataAndPercent?null==d.secondRowText?p=o/=3:p/=2:t!==D.categoryAndData&&t!==D.categoryAndPercent&&t!==D.dataAndPercent||null==d.secondRowText&&(p=o/=2),y.hasFlag(t,L.flagLabelStyleData)&&(b=void 0,(b=t!==L.labelStyleFlagEnum.categoryAndDataAndPercent&&t!==D.categoryAndData||null!=d.secondRowText?p:p-this.additionalSpaceWidth)<this.ellipsisWidth&&(r=!1),c=s({label:d.dataLabel,maxWidth:b,fontProperties:d.fontProperties})),y.hasFlag(t,L.flagLabelStyleCategory)&&(o<this.ellipsisWidth&&(r=!1),h=s({label:d.categoryLabel,maxWidth:o,fontProperties:d.fontProperties})),y.hasFlag(t,L.flagLabelStylePercent)){var b=void 0;switch(t){case D.categoryAndDataAndPercent:b=p-this.additionalParenthesesWidth-this.additionalSpaceWidth;break;case D.dataAndPercent:b=null==d.secondRowText?p-this.additionalParenthesesWidth-this.additionalSpaceWidth:p-this.additionalParenthesesWidth;break;case D.categoryAndPercent:b=p-this.additionalSpaceWidth;break;default:D.percent;b=p}b<this.ellipsisWidth&&(r=!1),u=s({label:d.percentLabel,maxWidth:b,fontProperties:d.fontProperties})}switch(c&&""!==c||h&&""!==h||u&&""!==u||(r=!1),t){case D.categoryAndDataAndPercent:u=u?"(".concat(u,")"):null,null==d.secondRowText?g=C.combineStrings([h,c,u]," "):(g=C.combineStrings([c,u]," "),d.secondRowText=h);break;case D.categoryAndData:null==d.secondRowText?g=C.combineStrings([h,c]," "):(g=c,d.secondRowText=h);break;case D.categoryAndPercent:null==d.secondRowText?g=C.combineStrings([h,u]," "):(g=u,d.secondRowText=h);break;case D.dataAndPercent:u=u?"(".concat(u,")"):null,null==d.secondRowText?g=C.combineStrings([c,u]," "):(g=u,d.secondRowText=c);break;case D.data:g=c;break;case D.percent:g=u;break;default:D.category;g=h}return s=t===D.categoryAndDataAndPercent&&null==d.secondRowText?o+p+p:t===D.categoryAndData||t===D.categoryAndPercent?o+p:t===D.dataAndPercent?p+p:o,d.textSize.width=Math.min(d.textSize.width,s),{boundingBox:l,text:g,tooltip:a?d.tooltip:null,isVisible:r,identity:d.identity,fontProperties:m.inherit(d.fontProperties,{color:a?d.outsideFill:d.insideFill}),selected:!1,textAnchor:n,leaderLinePoints:e.renderLeaderLines?d.leaderLinePoints:void 0,hasBackground:!a&&i.enableBackgroundWithAuto===S.on,secondRowText:d.secondRowText,backgroundColor:d.backgroundColor,backgroundTransparency:d.backgroundTransparency,outside:a}},h.tryPositionPoint=function(e,t,a,i,r,n,s){void 0===n&&(n=0);var o=a.parentShape,s=null==s||!s.pieChartMarginBetweenSlices||C.startingLabelOffset-n<C.startingLabelOffset?C.startingLabelOffset:C.startingLabelOffset-n,n=_.clone(a.textSize),r=(n.width=Math.min(n.width,f.getSpaceAvailableForDonutLabels(o.point.x,r)),v.DataLabelPointPositioner.getLabelRect(n,o,t,s)),n={point:{x:a.leaderLinePoints[0][0],y:(a.leaderLinePoints[0][1]<0?a.leaderLinePoints[1]:a.leaderLinePoints[0])[1]},radius:0,validPositions:null},o=v.DataLabelPointPositioner.getLabelRect(a.linesSize[f.DiagonalLineIndex],n,t,s),n={point:{x:a.leaderLinePoints[1][0],y:a.leaderLinePoints[1][1]},radius:0,validPositions:null},a=v.DataLabelPointPositioner.getLabelRect(a.linesSize[f.HorizontalLineIndex],n,t,s);if(r&&o&&a)return r.left+=i.x,r.top+=i.y,n=i.x-r.width/2,o.left+=n,o.top+=i.y,a.left+=n,a.top+=i.y,e.hasConflict(r)||e.hasConflict(o)||e.hasConflict(a)?void 0:{textRect:r,diagonalLineRect:o,horizontalLineRect:a}},h.getLabelPointPositions=function(e,t){var a=e.validPositions[0];return t?e.point.y<0?8===a?[64]:[128]:8===a?[16]:[32]:4===a?[128,32]:[16,64]},h.prototype.splitDonutDataPoint=function(e,t){var a=e.labelDataPoint,i=a.categoryLabelSize?a.categoryLabelSize.width:0,r=a.dataLabelSize?a.dataLabelSize.width:0,n=a.percentLabelSize?t===L.dataAndPercent?a.percentLabelSize.width+this.additionalParenthesesWidth:t===L.categoryAndDataAndPercent?a.percentLabelSize.width+this.additionalParenthesesWidth+this.additionalSpaceWidth:a.percentLabelSize.width:0,s=a.categoryLabelSize?a.categoryLabelSize.height:0,o=a.dataLabelSize?a.dataLabelSize.height:0,l=a.percentLabelSize?a.percentLabelSize.height:0,i={width:t===L.dataAndPercent?Math.max(r,n):Math.max(i,r+n),height:2*Math.max(s,Math.max(o,l))},r=_.clone(a);return r.textSize=i,r.secondRowText=t===L.dataAndPercent?a.dataLabel:a.categoryLabel,{labelDataPoint:r,hasBeenRendered:e.hasBeenRendered,labelSize:e.labelSize}},h.generateCandidateAngleForPosition=function(e,t){var a=e.startAngle+(e.endAngle-e.startAngle)/2;switch(t){case 64:case 32:return(e.startAngle+a-Math.PI)/2;case 128:case 16:return(a+e.endAngle-Math.PI)/2}},h.prototype.getPointPositionForAngle=function(e){var t=f.getXPositionForDonutLabel(Math.cos(e)*this.labelRadius);return{point:{x:t,y:Math.sin(e)*this.labelRadius},validPositions:[t<0?4:8],radius:0}},h.prototype.score=function(e,t){var a,i,t=f.getSpaceAvailableForDonutLabels(t.x,this.donutChartProperties.viewport),r=this.donutChartProperties.dataLabelsSettings.labelStyle,n=e.categoryLabelSize?e.categoryLabelSize.width:0,s=e.dataLabelSize?e.dataLabelSize.width:0,o=e.percentLabelSize?e.percentLabelSize.width:0;if(r===L.categoryAndDataAndPercent){if(null!=e.secondRowText)return a=Math.max(n-t,0),i=Math.max(Math.max(s,o+this.additionalParenthesesWidth+this.additionalSpaceWidth)-t/2,0),Math.max(a,i);a=Math.max(n,s+this.additionalSpaceWidth,o+this.additionalParenthesesWidth+this.additionalSpaceWidth),t/=3}else r===L.categoryAndData&&null==e.secondRowText?(a=Math.max(n,s+this.additionalSpaceWidth),t/=2):r===L.categoryAndPercent&&null==e.secondRowText?(a=Math.max(n,o+this.additionalSpaceWidth),t/=2):r===L.dataAndPercent?(a=null==e.secondRowText?Math.max(s,o+this.additionalParenthesesWidth+this.additionalSpaceWidth):Math.max(s,o+this.additionalParenthesesWidth),t/=2):a=e.textSize.width;return Math.max(a-t,0)},v.DonutLabelLayout=h}(powerbi=powerbi||{}),function(e){((e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).imporDonutChartModule=function(){}}(es6=es6||{}),function(e){var t;(t=e.visuals||(e.visuals={})).initializeDonutChartFactoryES6=function(){t.setCreateDonutChart(function(t){return es6.powerbi.visuals.imporDonutChartModule().then(function(e){return new e.DonutChart(t)})})}}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['donutChartVisuals.min.js'] || (this.parseTimeMarkers['donutChartVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
